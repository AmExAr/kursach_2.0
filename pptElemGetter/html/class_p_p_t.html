<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ParsingPPT: PPT Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="IconPPT.png"/></td>
  <td id="projectalign">
   <div id="projectname">ParsingPPT
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_p_p_t-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">PPT Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="ppt_elements_8h_source.html">pptElements.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:afb52a0e486f9ad4c1bb4334b39e36e3e" id="r_afb52a0e486f9ad4c1bb4334b39e36e3e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afb52a0e486f9ad4c1bb4334b39e36e3e">PPT</a> (wchar_t *filePath)</td></tr>
<tr class="separator:afb52a0e486f9ad4c1bb4334b39e36e3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34449b17365c5a447e3b8dcd8a17cf88" id="r_a34449b17365c5a447e3b8dcd8a17cf88"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a34449b17365c5a447e3b8dcd8a17cf88">~PPT</a> ()</td></tr>
<tr class="separator:a34449b17365c5a447e3b8dcd8a17cf88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e2aa83987ffbedf44f8f49444f894cc" id="r_a8e2aa83987ffbedf44f8f49444f894cc"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8e2aa83987ffbedf44f8f49444f894cc">GetText</a> (wchar_t *filePath)</td></tr>
<tr class="separator:a8e2aa83987ffbedf44f8f49444f894cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Класс для файлов формата <a class="el" href="class_p_p_t.html">PPT</a> </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">offsetToCurrentEdit</td><td>смещение к последнему изменению </td></tr>
    <tr><td class="paramname">PowerPointDocument</td><td>Поток PowerPointDocument </td></tr>
    <tr><td class="paramname">Pictures</td><td>Поток Pictures </td></tr>
    <tr><td class="paramname"><a class="el" href="class_p_p_t.html">PPT</a></td><td>Конструктор <a class="el" href="class_p_p_t.html">PPT</a> файла </td></tr>
    <tr><td class="paramname"><a class="el" href="class_p_p_t.html">PPT</a></td><td>Деструктор <a class="el" href="class_p_p_t.html">PPT</a> файла </td></tr>
    <tr><td class="paramname">GetText</td><td>Метод, с помощью которого достется текст и записывается в файл </td></tr>
  </table>
  </dd>
</dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="afb52a0e486f9ad4c1bb4334b39e36e3e" name="afb52a0e486f9ad4c1bb4334b39e36e3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb52a0e486f9ad4c1bb4334b39e36e3e">&#9670;&#160;</a></span>PPT()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PPT::PPT </td>
          <td>(</td>
          <td class="paramtype">wchar_t *</td>          <td class="paramname"><span class="paramname"><em>filePath</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Констурктор класса </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filePath</td><td>Путь к объекту</td></tr>
  </table>
  </dd>
</dl>
<p>Открытие файла презентации в режиме бинарного чтения: </p><div class="fragment"><div class="line">FILE *file = _wfopen(filePath, L<span class="stringliteral">&quot;rb&quot;</span>)</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordflow">if</span>(file == NULL)</div>
<div class="line">    {</div>
<div class="line">        std::wcout &lt;&lt; L<span class="stringliteral">&quot;Файл не открылся!!!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
</div><!-- fragment --><p>Переходим в конец файла, получаем его размер и переходим в начало файла </p><div class="fragment"><div class="line">_fseeki64(file, 0, SEEK_END);</div>
<div class="line"><span class="keywordtype">size_t</span> fileSize = _ftelli64(file);</div>
<div class="line">_fseeki64(file, 0, SEEK_SET);</div>
</div><!-- fragment --><p>Массив, в которы загружаем весь файл </p><div class="fragment"><div class="line">BYTE *buffer = <span class="keyword">new</span> BYTE[fileSize];</div>
</div><!-- fragment --><p>Записываем в буффер каждый элемент. Если ошибка, то выводим сообщение </p><div class="fragment"><div class="line"><span class="keywordflow">if</span>(fread(buffer, 1, fileSize, file) != fileSize)</div>
<div class="line">    {</div>
<div class="line">        std::wcout &lt;&lt; L<span class="stringliteral">&quot;Ошибка чтения файла&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
</div><!-- fragment --><p>Закрытие файла </p><div class="fragment"><div class="line">fclose (file);</div>
</div><!-- fragment --><p>Создаем переменную для хранения имени потока и массив для хранения потока, далее сопоставляем массив и имя потока. DataStreams - массив из массивов потоков </p><div class="fragment"><div class="line">std::wstring defaultExtension;</div>
<div class="line">std::vector&lt;CompoundDocumentObject::CompoundDocument_DirectoryEntryStruct&gt; Directory;</div>
<div class="line">std::map&lt;std::wstring, ULONGLONG&gt; NameMap;</div>
<div class="line">std::vector&lt;BinaryBlock&gt; DataStreams;</div>
</div><!-- fragment --><p>Разбор <a class="el" href="class_p_p_t.html">PPT</a> файла </p><div class="fragment"><div class="line">DWORD realDataSize = <a class="code hl_function" href="namespace_compound_document_object.html#a1e33b6a4c89ae03c181a51c2d27a1ce9">CompoundDocumentObject::GetCompoundDocumentInfo</a>(buffer, fileSize, defaultExtension, Directory, NameMap, DataStreams)</div>
<div class="ttc" id="anamespace_compound_document_object_html_a1e33b6a4c89ae03c181a51c2d27a1ce9"><div class="ttname"><a href="namespace_compound_document_object.html#a1e33b6a4c89ae03c181a51c2d27a1ce9">CompoundDocumentObject::GetCompoundDocumentInfo</a></div><div class="ttdeci">DWORD GetCompoundDocumentInfo(const BYTE *documentData, DWORD dataSize, wstring &amp;defaultExtension, std::vector&lt; CompoundDocument_DirectoryEntryStruct &gt; &amp;Directory, std::map&lt; wstring, ULONGLONG &gt; &amp;NameMap, vector&lt; BinaryBlock &gt; &amp;dataStreams)</div><div class="ttdef"><b>Definition</b> pptElements.cpp:123</div></div>
</div><!-- fragment --><p>Переменные для хранения индекса потока </p><div class="fragment"><div class="line">DWORDLONG powerPointDocumentIndex</div>
<div class="line">DWORDLONG currentUserIndex</div>
<div class="line">DWORDLONG picturesIndex</div>
</div><!-- fragment --><p>Перебор всех потоков </p><div class="fragment"><div class="line"><span class="keywordflow">for</span>(std::map&lt;std::wstring, ULONGLONG&gt;::const_iterator i=NameMap.begin(); i!=NameMap.end(); i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(i-&gt;first == L<span class="stringliteral">&quot;PowerPoint Document&quot;</span>)</div>
<div class="line">        {</div>
<div class="line">            powerPointDocumentIndex = i-&gt;second;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(i-&gt;first == L<span class="stringliteral">&quot;Current User&quot;</span>)</div>
<div class="line">        {</div>
<div class="line">            currentUserIndex = i-&gt;second;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(i-&gt;first == L<span class="stringliteral">&quot;Pictures&quot;</span>)</div>
<div class="line">        {</div>
<div class="line">            picturesIndex = i-&gt;second;</div>
<div class="line">            Pictures = DataStreams[picturesIndex];</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><p>Взятие из DataStreams массива необходимого потока </p><div class="fragment"><div class="line"><a class="code hl_typedef" href="ppt_elements_8h.html#a50bf96b5901e1f63b7f3d2937ecdf635">BinaryBlock</a> CurrentUser = DataStreams[currentUserIndex]</div>
<div class="line">PowerPointDocument = DataStreams[powerPointDocumentIndex]</div>
<div class="ttc" id="appt_elements_8h_html_a50bf96b5901e1f63b7f3d2937ecdf635"><div class="ttname"><a href="ppt_elements_8h.html#a50bf96b5901e1f63b7f3d2937ecdf635">BinaryBlock</a></div><div class="ttdeci">std::vector&lt; BYTE &gt; BinaryBlock</div><div class="ttdef"><b>Definition</b> pptElements.h:11</div></div>
</div><!-- fragment --><p>Применение к потоку CureentUser соответствующую структуру </p><div class="fragment"><div class="line"><a class="code hl_struct" href="struct_current_user_atom.html">CurrentUserAtom</a> *user = (<a class="code hl_struct" href="struct_current_user_atom.html">CurrentUserAtom</a>*)CurrentUser.data();</div>
<div class="ttc" id="astruct_current_user_atom_html"><div class="ttname"><a href="struct_current_user_atom.html">CurrentUserAtom</a></div><div class="ttdef"><b>Definition</b> pptElements.h:131</div></div>
</div><!-- fragment --><p>Присваивание смещения к последнему изменению </p><div class="fragment"><div class="line">offsetToCurrentEdit = user-&gt;<a class="code hl_variable" href="struct_current_user_atom.html#a6bb89bfd9fe412a2b328674a60f95e74">offsetToCurrentEdit</a>;</div>
<div class="ttc" id="astruct_current_user_atom_html_a6bb89bfd9fe412a2b328674a60f95e74"><div class="ttname"><a href="struct_current_user_atom.html#a6bb89bfd9fe412a2b328674a60f95e74">CurrentUserAtom::offsetToCurrentEdit</a></div><div class="ttdeci">DWORD offsetToCurrentEdit</div><div class="ttdef"><b>Definition</b> pptElements.h:135</div></div>
</div><!-- fragment --><p>Очистка памяти </p><div class="fragment"><div class="line"><span class="keyword">delete</span>[] buffer;</div>
<div class="line">Directory.clear();</div>
<div class="line">NameMap.clear();</div>
<div class="line">DataStreams.clear();</div>
</div><!-- fragment --> 
</div>
</div>
<a id="a34449b17365c5a447e3b8dcd8a17cf88" name="a34449b17365c5a447e3b8dcd8a17cf88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34449b17365c5a447e3b8dcd8a17cf88">&#9670;&#160;</a></span>~PPT()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PPT::~PPT </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Декструктор <a class="el" href="class_p_p_t.html">PPT</a> файла </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a8e2aa83987ffbedf44f8f49444f894cc" name="a8e2aa83987ffbedf44f8f49444f894cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e2aa83987ffbedf44f8f49444f894cc">&#9670;&#160;</a></span>GetText()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PPT::GetText </td>
          <td>(</td>
          <td class="paramtype">wchar_t *</td>          <td class="paramname"><span class="paramname"><em>filePath</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Получение указателя на поток PowerPointDocument </p><div class="fragment"><div class="line">BYTE *buffer = PowerPointDocument.data();</div>
</div><!-- fragment --><p>Указатель на начало потока </p><div class="fragment"><div class="line">BYTE *powerPointDocumentBegin = buffer;</div>
</div><!-- fragment --><p>Переход к записи текущего изменения и примененение структуры </p><div class="fragment"><div class="line">buffer = powerPointDocumentBegin + offsetToCurrentEdit;</div>
<div class="line"><a class="code hl_struct" href="struct_user_edit_atom.html">UserEditAtom</a> *userEdit = (<a class="code hl_struct" href="struct_user_edit_atom.html">UserEditAtom</a>*)buffer;</div>
<div class="ttc" id="astruct_user_edit_atom_html"><div class="ttname"><a href="struct_user_edit_atom.html">UserEditAtom</a></div><div class="ttdef"><b>Definition</b> pptElements.h:150</div></div>
</div><!-- fragment --><p>Переход к DirectoryEntry и применение структуры </p><div class="fragment"><div class="line">buffer = powerPointDocumentBegin + userEdit-&gt;<a class="code hl_variable" href="struct_user_edit_atom.html#a13ec0d26a2cc047b380cefa3ae2d19d5">offsetPersistDirectory</a> + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>);</div>
<div class="line"><a class="code hl_typedef" href="ppt_elements_8h.html#a8f00d641132d057c36fa47edad8c9ef5">persistIdAndcPersist</a> *idAndCount = (<a class="code hl_typedef" href="ppt_elements_8h.html#a8f00d641132d057c36fa47edad8c9ef5">persistIdAndcPersist</a>*)buffer;</div>
<div class="ttc" id="appt_elements_8h_html_a8f00d641132d057c36fa47edad8c9ef5"><div class="ttname"><a href="ppt_elements_8h.html#a8f00d641132d057c36fa47edad8c9ef5">persistIdAndcPersist</a></div><div class="ttdeci">uint32_t persistIdAndcPersist</div><div class="ttdoc">Id и количество DirectoryEntry.</div><div class="ttdef"><b>Definition</b> pptElements.h:105</div></div>
<div class="ttc" id="astruct_record_header_html"><div class="ttname"><a href="struct_record_header.html">RecordHeader</a></div><div class="ttdef"><b>Definition</b> pptElements.h:116</div></div>
<div class="ttc" id="astruct_user_edit_atom_html_a13ec0d26a2cc047b380cefa3ae2d19d5"><div class="ttname"><a href="struct_user_edit_atom.html#a13ec0d26a2cc047b380cefa3ae2d19d5">UserEditAtom::offsetPersistDirectory</a></div><div class="ttdeci">DWORD offsetPersistDirectory</div><div class="ttdef"><b>Definition</b> pptElements.h:157</div></div>
</div><!-- fragment --><p>Получение записи cPersist и преобразнование записей в LittleEndian </p><div class="fragment"><div class="line">DWORD cPersist = (*idAndCount &gt;&gt; 12) &amp; 0xFFFFF;</div>
<div class="line">cPersist = (cPersist &amp; 0xFF) &lt;&lt; 8 | (cPersist &amp; 0xFF00) &gt;&gt;  8;</div>
</div><!-- fragment --><p>Составление таблицы смещений к сохраненным объектам </p><div class="fragment"><div class="line">DWORD *directoryEntry = (DWORD*)(buffer + <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="ppt_elements_8h.html#a8f00d641132d057c36fa47edad8c9ef5">persistIdAndcPersist</a>));</div>
</div><!-- fragment --><p>Переход к DocumentContainer пропуская <a class="el" href="struct_record_header.html">RecordHeader</a> </p><div class="fragment"><div class="line">buffer = powerPointDocumentBegin + directoryEntry[0] + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>);</div>
</div><!-- fragment --><p>Применение структуры <a class="el" href="struct_record_header.html">RecordHeader</a> </p><div class="fragment"><div class="line"><a class="code hl_struct" href="struct_record_header.html">RecordHeader</a> *rh = (<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>*)buffer;</div>
</div><!-- fragment --><p>Поиск типа записи, соотвествующей контейнеру с текстом (в MS <a class="el" href="class_p_p_t.html">PPT</a> 1992-2003) </p><div class="fragment"><div class="line"><span class="keywordflow">while</span>(rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a90c5c22d140a359c49948ed2d036bc0c">recType</a> != (WORD)<a class="code hl_enumvalue" href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecab6a457c65d4ffdaac7ec1941c94d5179">RecordTypeEnum::RT_SlideListWithText</a> || rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a5657a2d9ed1bf1d410ca5c75fc7ebe9e">recVerAndInstance</a> != 0x000F)</div>
<div class="line">{</div>
<div class="line">    buffer += rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a03d23623eed1144460cfaaefe462ce32">recLen</a> + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>);</div>
<div class="line">    rh = (<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>*)buffer;</div>
<div class="line">}</div>
<div class="ttc" id="appt_elements_8h_html_a46a608b0e70d25d1aa164134b40207ecab6a457c65d4ffdaac7ec1941c94d5179"><div class="ttname"><a href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecab6a457c65d4ffdaac7ec1941c94d5179">RecordTypeEnum::RT_SlideListWithText</a></div><div class="ttdeci">@ RT_SlideListWithText</div></div>
<div class="ttc" id="astruct_record_header_html_a03d23623eed1144460cfaaefe462ce32"><div class="ttname"><a href="struct_record_header.html#a03d23623eed1144460cfaaefe462ce32">RecordHeader::recLen</a></div><div class="ttdeci">DWORD recLen</div><div class="ttdef"><b>Definition</b> pptElements.h:119</div></div>
<div class="ttc" id="astruct_record_header_html_a5657a2d9ed1bf1d410ca5c75fc7ebe9e"><div class="ttname"><a href="struct_record_header.html#a5657a2d9ed1bf1d410ca5c75fc7ebe9e">RecordHeader::recVerAndInstance</a></div><div class="ttdeci">WORD recVerAndInstance</div><div class="ttdef"><b>Definition</b> pptElements.h:117</div></div>
<div class="ttc" id="astruct_record_header_html_a90c5c22d140a359c49948ed2d036bc0c"><div class="ttname"><a href="struct_record_header.html#a90c5c22d140a359c49948ed2d036bc0c">RecordHeader::recType</a></div><div class="ttdeci">WORD recType</div><div class="ttdef"><b>Definition</b> pptElements.h:118</div></div>
</div><!-- fragment --><p>Вход в SlideListWithText </p><div class="fragment"><div class="line"><span class="keywordflow">while</span>(rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a90c5c22d140a359c49948ed2d036bc0c">recType</a> != (WORD)<a class="code hl_enumvalue" href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecab6a457c65d4ffdaac7ec1941c94d5179">RecordTypeEnum::RT_SlideListWithText</a> || rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a5657a2d9ed1bf1d410ca5c75fc7ebe9e">recVerAndInstance</a> != 0x000F)</div>
<div class="line">{</div>
<div class="line">    buffer += <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>);</div>
<div class="line">    rh = (<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>*)buffer;</div>
<div class="line">}</div>
</div><!-- fragment --><p>\parma bool isTextHere переменная для проверки на наличие текста</p>
<p>Открытие фалйа в бинарной записи </p><div class="fragment"><div class="line">FILE *file = _wfopen(filePath, L<span class="stringliteral">&quot;wb&quot;</span>)</div>
</div><!-- fragment --><p> \parma DWORD slideNumber переменнная для подсчета слайдов</p>
<p>Перебор всех элементов до конца DocumentContainer </p><div class="fragment"><div class="line"><span class="keywordflow">while</span>(rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a90c5c22d140a359c49948ed2d036bc0c">recType</a> != (WORD)<a class="code hl_enumvalue" href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecac1c58b615dda4bd18696469f0e9b071d">RecordTypeEnum::RT_EndDocumentAtom</a>)</div>
<div class="ttc" id="appt_elements_8h_html_a46a608b0e70d25d1aa164134b40207ecac1c58b615dda4bd18696469f0e9b071d"><div class="ttname"><a href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecac1c58b615dda4bd18696469f0e9b071d">RecordTypeEnum::RT_EndDocumentAtom</a></div><div class="ttdeci">@ RT_EndDocumentAtom</div></div>
</div><!-- fragment --><p>Если находится тип, соответствующий <a class="el" href="struct_slide_persist_atom.html">SlidePersistAtom</a>, то увеличивается номер слайда и этот номер записывается </p><div class="fragment"><div class="line"><span class="keywordflow">if</span>(rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a90c5c22d140a359c49948ed2d036bc0c">recType</a> == (WORD)<a class="code hl_enumvalue" href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecaa02cbe42c111aa6dcf5a5804d823301f">RecordTypeEnum::RT_SlidePersistAtom</a> &amp;&amp; rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a5657a2d9ed1bf1d410ca5c75fc7ebe9e">recVerAndInstance</a> == 0x0000)</div>
<div class="line">{</div>
<div class="line">    fwprintf(file, L<span class="stringliteral">&quot;Слайд номер %u: \n&quot;</span>, ++slideNumber);</div>
<div class="line">}</div>
<div class="ttc" id="appt_elements_8h_html_a46a608b0e70d25d1aa164134b40207ecaa02cbe42c111aa6dcf5a5804d823301f"><div class="ttname"><a href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecaa02cbe42c111aa6dcf5a5804d823301f">RecordTypeEnum::RT_SlidePersistAtom</a></div><div class="ttdeci">@ RT_SlidePersistAtom</div></div>
</div><!-- fragment --><p>Если находится тип, соответствующий тексту, то isTextHere = true, после чего если текст хранится в UTF-16, то делаем указатель на начало текста и записываем это в файл </p><div class="fragment"><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span>((rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a90c5c22d140a359c49948ed2d036bc0c">recType</a> == (WORD)<a class="code hl_enumvalue" href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecaf8a266a1da10e2f2cefd349d2a8ce0bb">RecordTypeEnum::RT_TextCharsAtom</a> || rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a90c5c22d140a359c49948ed2d036bc0c">recType</a> == (WORD)<a class="code hl_enumvalue" href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207eca3aa82887da0f8e5bf43095d85332cac1">RecordTypeEnum::RT_TextBytesAtom</a>) &amp;&amp;</div>
<div class="line">            rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a5657a2d9ed1bf1d410ca5c75fc7ebe9e">recVerAndInstance</a> == 0x0000)</div>
<div class="line">        {</div>
<div class="line">            isTextHere = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span>(rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a90c5c22d140a359c49948ed2d036bc0c">recType</a> == (WORD)<a class="code hl_enumvalue" href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecaf8a266a1da10e2f2cefd349d2a8ce0bb">RecordTypeEnum::RT_TextCharsAtom</a>)</div>
<div class="line">            {</div>
<div class="line">                WORD *text = (WORD*)(buffer + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>));</div>
<div class="line"> </div>
<div class="line">                fwrite(text, 2, (rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a03d23623eed1144460cfaaefe462ce32">recLen</a>)/2, file);</div>
<div class="line">                fwprintf(file, L<span class="stringliteral">&quot;\n\n&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                BYTE *text = buffer + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>);</div>
<div class="line"> </div>
<div class="line">                WORD *chars = (WORD*)(<a class="code hl_function" href="ppt_elements_8h.html#a053f0a24d005008e8a2c0ec2461536d3">TextBytesToChars</a>(text, rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a03d23623eed1144460cfaaefe462ce32">recLen</a>));</div>
<div class="line"> </div>
<div class="line">                fwrite(chars, 2, rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a03d23623eed1144460cfaaefe462ce32">recLen</a>, file);</div>
<div class="line">                fwprintf(file, L<span class="stringliteral">&quot;\n\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                <span class="keyword">delete</span>[] chars;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="ttc" id="appt_elements_8h_html_a053f0a24d005008e8a2c0ec2461536d3"><div class="ttname"><a href="ppt_elements_8h.html#a053f0a24d005008e8a2c0ec2461536d3">TextBytesToChars</a></div><div class="ttdeci">BYTE * TextBytesToChars(BYTE *data, DWORD dataSize)</div><div class="ttdef"><b>Definition</b> pptElements.cpp:1085</div></div>
<div class="ttc" id="appt_elements_8h_html_a46a608b0e70d25d1aa164134b40207eca3aa82887da0f8e5bf43095d85332cac1"><div class="ttname"><a href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207eca3aa82887da0f8e5bf43095d85332cac1">RecordTypeEnum::RT_TextBytesAtom</a></div><div class="ttdeci">@ RT_TextBytesAtom</div></div>
<div class="ttc" id="appt_elements_8h_html_a46a608b0e70d25d1aa164134b40207ecaf8a266a1da10e2f2cefd349d2a8ce0bb"><div class="ttname"><a href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecaf8a266a1da10e2f2cefd349d2a8ce0bb">RecordTypeEnum::RT_TextCharsAtom</a></div><div class="ttdeci">@ RT_TextCharsAtom</div></div>
</div><!-- fragment --><p>Если запись не была найдена, то переходим к другой записи </p><div class="fragment"><div class="line">buffer += <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>) + rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a03d23623eed1144460cfaaefe462ce32">recLen</a>;</div>
<div class="line">rh = (<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>*)buffer;</div>
</div><!-- fragment --><p>Закрытие файла, вывод надписи, если текст был найден. Иначе используем другой алгоритм поиска (для MS <a class="el" href="class_p_p_t.html">PPT</a> 2007 и позже) </p><div class="fragment"><div class="line">fclose(file);</div>
<div class="line"><span class="keywordflow">if</span>(isTextHere)</div>
<div class="line">{</div>
<div class="line">    std::wcout &lt;&lt; L<span class="stringliteral">&quot;Текст из презентации был успешно сохранён в ваш файл!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Иначе используем другой алгоритм поиска (для MS <a class="el" href="class_p_p_t.html">PPT</a> 2007 и позже) Происходит перебор всех элементов из directoryEntry, начиная со второго элемента Если не первый слайд, то добавляем пропуск строки. Написание номера слайда, </p><div class="fragment"><div class="line"><span class="keywordflow">if</span>(i &gt; 2)</div>
<div class="line">{</div>
<div class="line">    fwprintf(file, L<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line">fwprintf(file, L<span class="stringliteral">&quot;Слайд номер %u: \n&quot;</span>, (i - 1));</div>
</div><!-- fragment --><p>Переход к первому сохраненному объекту </p><div class="fragment"><div class="line">buffer = powerPointDocumentBegin + directoryEntry[i];</div>
<div class="line">\encdcode</div>
<div class="line"> </div>
<div class="line">Применение струкутры <a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>. В нем находится размер всего слайда</div>
<div class="line">\code</div>
<div class="line">rh = (<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>*)buffer;</div>
<div class="line">\encdcode</div>
<div class="line"> </div>
<div class="line">Создать указатель на конец сладйа</div>
<div class="line">\code</div>
<div class="line">BYTE *endOfSlide = buffer + rh-&gt;<a class="code hl_variable" href="struct_record_header.html#a03d23623eed1144460cfaaefe462ce32">recLen</a> + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>);</div>
<div class="line">\encdcode</div>
<div class="line"> </div>
<div class="line">Пропуск записи <a class="code hl_struct" href="struct_slide_container.html">SlideContainer</a> и OfficeArtDgContainer</div>
<div class="line">\code</div>
<div class="line"> buffer += <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_slide_container.html">SlideContainer</a>) + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_office_art_dg_container.html">OfficeArtDgContainer</a>);</div>
<div class="line">\encdcode</div>
<div class="line"> </div>
<div class="line">Повторное применение струкутры RecordHeader</div>
<div class="line">\code</div>
<div class="line">rh = (<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>*)buffer;</div>
<div class="line">\encdcode</div>
<div class="line"> </div>
<div class="line">С помощью цикла ищем OfficeArtSpContainer</div>
<div class="line">\code</div>
<div class="line"><span class="keywordflow">while</span>(rh-&gt;recType != (WORD)<a class="code hl_enumvalue" href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecaad5470dfe01c26e15228661f87eb0cde">RecordTypeEnum::RT_OfficeArtSpContainer</a> || rh-&gt;recVerAndInstance != 0x000F)</div>
<div class="line">{</div>
<div class="line">    buffer += rh-&gt;recLen + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>);</div>
<div class="line">    rh = (<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>*)buffer;</div>
<div class="line">}</div>
<div class="line">\encdcode</div>
<div class="line"> </div>
<div class="line">Пропуск заголовка</div>
<div class="line">\code</div>
<div class="line">buffer += <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>);</div>
<div class="line">rh = (<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>*)buffer;</div>
<div class="line">\encdcode</div>
<div class="line"> </div>
<div class="line">Поиск OfficeArtClientTextbox</div>
<div class="line">\code</div>
<div class="line"><span class="keywordflow">while</span>(rh-&gt;recType != (WORD)<a class="code hl_enumvalue" href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecae4b4a80700b7566f2001137f86812dd7">RecordTypeEnum::RT_OfficeArtClientTextbox</a> || rh-&gt;recVerAndInstance != 0x000F)</div>
<div class="line">{</div>
<div class="line">    buffer += rh-&gt;recLen + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>);;</div>
<div class="line">    rh = (<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>*)buffer;</div>
<div class="line">}</div>
<div class="line">\encdcode</div>
<div class="line"> </div>
<div class="line">Пока слайд не закончится, ищем текст в OfficeArtClientTextbox</div>
<div class="line">\code</div>
<div class="line"><span class="keywordflow">while</span>(buffer != endOfSlide)</div>
<div class="line">\encdcode</div>
<div class="line"> </div>
<div class="line">Если текст находится внутри текста, то аналогичным образом перейти к ClientTextBox</div>
<div class="line">\code</div>
<div class="line"><span class="keywordflow">if</span>(rh-&gt;recType == (WORD)<a class="code hl_enumvalue" href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecaad5470dfe01c26e15228661f87eb0cde">RecordTypeEnum::RT_OfficeArtSpContainer</a> &amp;&amp; rh-&gt;recVerAndInstance == 0x000F)</div>
<div class="line">{</div>
<div class="line">    BYTE *endOfSpContainer = buffer + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>) + rh-&gt;recLen;</div>
<div class="line"> </div>
<div class="line">    buffer += <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>);</div>
<div class="line">    rh = (<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>*)buffer;            {</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">while</span>(buffer != endOfSpContainer)</div>
<div class="line">                    {</div>
<div class="line">                        buffer += rh-&gt;recLen + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>);;</div>
<div class="line">                        rh = (<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>*)buffer;</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span>(rh-&gt;recType == (WORD)<a class="code hl_enumvalue" href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecae4b4a80700b7566f2001137f86812dd7">RecordTypeEnum::RT_OfficeArtClientTextbox</a> &amp;&amp; rh-&gt;recVerAndInstance == 0x000F)</div>
<div class="line">                        {</div>
<div class="line">                            buffer += <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>);</div>
<div class="line">                            rh = (<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>*)buffer;</div>
<div class="line"> </div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">\encdcode</div>
<div class="line"> </div>
<div class="line">Аналогичные действия, если найден текст</div>
<div class="line">\code</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span>((rh-&gt;recType == (WORD)<a class="code hl_enumvalue" href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecaf8a266a1da10e2f2cefd349d2a8ce0bb">RecordTypeEnum::RT_TextCharsAtom</a> || rh-&gt;recType == (WORD)<a class="code hl_enumvalue" href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207eca3aa82887da0f8e5bf43095d85332cac1">RecordTypeEnum::RT_TextBytesAtom</a>) &amp;&amp;</div>
<div class="line">                         rh-&gt;recVerAndInstance == 0x0000)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span>(rh-&gt;recType == (WORD)<a class="code hl_enumvalue" href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecaf8a266a1da10e2f2cefd349d2a8ce0bb">RecordTypeEnum::RT_TextCharsAtom</a>)</div>
<div class="line">                    {</div>
<div class="line">                        WORD *text = (WORD*)(buffer + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>));</div>
<div class="line"> </div>
<div class="line">                        fwrite(text, 2, (rh-&gt;recLen)/2, file);</div>
<div class="line">                        fwprintf(file, L<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span></div>
<div class="line">                    {</div>
<div class="line">                        BYTE *text = buffer + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>);</div>
<div class="line"> </div>
<div class="line">                        WORD *chars = (WORD*)(<a class="code hl_function" href="ppt_elements_8h.html#a053f0a24d005008e8a2c0ec2461536d3">TextBytesToChars</a>(text, rh-&gt;recLen));</div>
<div class="line"> </div>
<div class="line">                        fwrite(chars, 2, rh-&gt;recLen, file);</div>
<div class="line">                        fwprintf(file, L<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                        <span class="keyword">delete</span>[] chars;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                buffer += <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>) + rh-&gt;recLen;</div>
<div class="line">                rh = (<a class="code hl_struct" href="struct_record_header.html">RecordHeader</a>*)buffer;</div>
<div class="line">            }</div>
<div class="ttc" id="appt_elements_8h_html_a46a608b0e70d25d1aa164134b40207ecaad5470dfe01c26e15228661f87eb0cde"><div class="ttname"><a href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecaad5470dfe01c26e15228661f87eb0cde">RecordTypeEnum::RT_OfficeArtSpContainer</a></div><div class="ttdeci">@ RT_OfficeArtSpContainer</div></div>
<div class="ttc" id="appt_elements_8h_html_a46a608b0e70d25d1aa164134b40207ecae4b4a80700b7566f2001137f86812dd7"><div class="ttname"><a href="ppt_elements_8h.html#a46a608b0e70d25d1aa164134b40207ecae4b4a80700b7566f2001137f86812dd7">RecordTypeEnum::RT_OfficeArtClientTextbox</a></div><div class="ttdeci">@ RT_OfficeArtClientTextbox</div></div>
<div class="ttc" id="astruct_office_art_dg_container_html"><div class="ttname"><a href="struct_office_art_dg_container.html">OfficeArtDgContainer</a></div><div class="ttdef"><b>Definition</b> pptElements.h:193</div></div>
<div class="ttc" id="astruct_slide_container_html"><div class="ttname"><a href="struct_slide_container.html">SlideContainer</a></div><div class="ttdef"><b>Definition</b> pptElements.h:180</div></div>
</div><!-- fragment --><p>Закрытие файла </p><div class="fragment"><div class="line">fclose(file);</div>
</div><!-- fragment --> 
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="ppt_elements_8h_source.html">pptElements.h</a></li>
<li><a class="el" href="ppt_elements_8cpp.html">pptElements.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
